Below is a **practical backfill script plan** that aims to get you an “optimal” dataset for most historical-odds algorithms (CLV, line-velocity/regimes, etc.) **within a 50k-token budget**, without being constrained to “30 days” or “24h intervals”.

I’m going to assume “tokens” = **Odds API credits** (since that’s how you’ve been budgeting). If your `src.backfill` uses a different cost model, the structure still holds—just scale days/intervals up/down after you calibrate.

---

## Guiding principle: spend density where signal is highest

For most odds-driven models, the most informative movement is:

* **close to game time** (last ~72h, especially last 12–24h),
* and **across enough history** to learn seasonality + team effects.

So we use **tiered resolution**:

* **Tier A (high-res / recent):** small interval (e.g., 1–2h) over fewer days
* **Tier B (mid-res):** 4–6h interval over more days
* **Tier C (long-res):** 12–24h interval over the longest window

This gives you:

* clean line curves for velocity/regime features,
* enough samples for CLV and calibration,
* broad coverage without blowing tokens.

---

## 50k token budget allocation (recommended)

If you’re betting/optimizing mainly **NBA/NHL/NFL/NCAAB**:

**Budget split**

* **NBA:** 14k
* **NHL:** 14k
* **NFL:** 10k (fewer games → cheaper to cover deeper)
* **NCAAB:** 12k (lots of games → keep long window coarser)

Why this split: NBA/NHL provide tons of consistent events; NFL has fewer but high value; NCAAB is huge volume so you want breadth but with lower density.

---

## Script list (copy/paste commands)

These are written in the same style as your example:

### Tier A — last 45 days, high-resolution (builds great line-velocity curves)

Run **every sport** at **interval 1–2 hours** for recent history:

**NBA**

```powershell
PS C:\Users\immat\repos\betting_engine> .\.venv\Scripts\python.exe -m src.backfill --sport basketball_nba --days 45 --interval 1
```

**NHL**

```powershell
PS C:\Users\immat\repos\betting_engine> .\.venv\Scripts\python.exe -m src.backfill --sport icehockey_nhl --days 45 --interval 1
```

**NFL**

```powershell
PS C:\Users\immat\repos\betting_engine> .\.venv\Scripts\python.exe -m src.backfill --sport americanfootball_nfl --days 90 --interval 2
```

**NCAAB**

```powershell
PS C:\Users\immat\repos\betting_engine> .\.venv\Scripts\python.exe -m src.backfill --sport basketball_ncaab --days 30 --interval 2
```

Why these: Tier A is where you get the strongest “closing dynamics” training signal.

---

### Tier B — mid-resolution, medium horizon (stabilizes models + improves generalization)

**NBA/NHL**: 180 days @ 4h
**NFL**: 365 days @ 6h
**NCAAB**: 120 days @ 6h (avoid exploding cost)

**NBA**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport basketball_nba --days 180 --interval 4
```

**NHL**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport icehockey_nhl --days 180 --interval 4
```

**NFL**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport americanfootball_nfl --days 365 --interval 6
```

**NCAAB**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport basketball_ncaab --days 120 --interval 6
```

---

### Tier C — long horizon, coarse resolution (captures seasonality + priors cheaply)

This is the “wide net” layer. It’s especially useful for:

* baseline implied-prob calibration,
* team priors,
* “what does normal movement look like by day-of-week / month / etc.”

**NBA**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport basketball_nba --days 720 --interval 24
```

**NHL**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport icehockey_nhl --days 720 --interval 24
```

**NFL**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport americanfootball_nfl --days 1460 --interval 24
```

**NCAAB**

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport basketball_ncaab --days 365 --interval 24
```

---

## “Optimizer” version: run as a scripted batch (recommended)

Create a file like `backfill_50k.ps1`:

```powershell
$py = ".\.venv\Scripts\python.exe"

# Tier A (high-res recent)
& $py -m src.backfill --sport basketball_nba --days 45 --interval 1
& $py -m src.backfill --sport icehockey_nhl --days 45 --interval 1
& $py -m src.backfill --sport americanfootball_nfl --days 90 --interval 2
& $py -m src.backfill --sport basketball_ncaab --days 30 --interval 2

# Tier B (mid-res)
& $py -m src.backfill --sport basketball_nba --days 180 --interval 4
& $py -m src.backfill --sport icehockey_nhl --days 180 --interval 4
& $py -m src.backfill --sport americanfootball_nfl --days 365 --interval 6
& $py -m src.backfill --sport basketball_ncaab --days 120 --interval 6

# Tier C (coarse long horizon)
& $py -m src.backfill --sport basketball_nba --days 720 --interval 24
& $py -m src.backfill --sport icehockey_nhl --days 720 --interval 24
& $py -m src.backfill --sport americanfootball_nfl --days 1460 --interval 24
& $py -m src.backfill --sport basketball_ncaab --days 365 --interval 24
```

Run:

```powershell
powershell -ExecutionPolicy Bypass -File .\backfill_50k.ps1
```

---

## How to keep this inside 50k without guessing your exact burn rate

Because I don’t know how `src.backfill` maps to Odds API credits, do this **one simple calibration** and then scale confidently:

1. Run ONE representative command (e.g., NBA Tier A):

```powershell
.\.venv\Scripts\python.exe -m src.backfill --sport basketball_nba --days 7 --interval 1
```

2. Note credits spent for that run (whatever your logging shows).

3. Compute **credits/day** at that interval and scale:

* If 7 days @ 1h cost `X` credits, then Tier A NBA 45 days will cost about `X * (45/7)`.

4. If you’re burning too fast, the best knobs (in this order) are:

* increase Tier A interval: **1h → 2h**
* reduce Tier A window: **45d → 30d**
* keep Tier C (coarse) mostly intact (it’s cheap signal)

This lets you keep the overall “shape” of the dataset optimal even if the cost model is different than expected.

---

## Optional “if supported” upgrades (high ROI)

If `src.backfill` supports any of these flags (you’ll know from `--help`), they reduce waste and increase signal density:

* `--markets h2h,spreads,totals` (if you use spreads/totals algorithms)
* `--book draftkings` (or your target books only)
* `--since/--until` (for season slicing)
* `--league` vs `--sport` distinction (NCAAF vs NCAAB, etc.)

If you paste the output of:

```powershell
.\.venv\Scripts\python.exe -m src.backfill --help
```

…I can tailor the script list to **exact flags your backfill supports** (markets/books/regions), which is the biggest lever for making 50k credits go further.
